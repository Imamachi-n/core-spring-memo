<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring MVC and the Web Layer | Core Spring Memo</title>
    <meta name="description" content="Spring Framework 5.x / Spring Boot 2.x">
    <link rel="icon" href="/core-spring-memo/hero.jpg">
  <link rel="manifest" href="/core-spring-memo/manifest.json">
    
    <link rel="preload" href="/core-spring-memo/assets/css/0.styles.4a7dcf21.css" as="style"><link rel="preload" href="/core-spring-memo/assets/js/app.9728203e.js" as="script"><link rel="preload" href="/core-spring-memo/assets/js/10.06398a2e.js" as="script"><link rel="prefetch" href="/core-spring-memo/assets/js/2.f18bfe2d.js"><link rel="prefetch" href="/core-spring-memo/assets/js/3.ddf3836b.js"><link rel="prefetch" href="/core-spring-memo/assets/js/4.9842e8a8.js"><link rel="prefetch" href="/core-spring-memo/assets/js/5.0cce7d31.js"><link rel="prefetch" href="/core-spring-memo/assets/js/6.3a079ad4.js"><link rel="prefetch" href="/core-spring-memo/assets/js/7.33204f78.js"><link rel="prefetch" href="/core-spring-memo/assets/js/8.bfb6de9e.js"><link rel="prefetch" href="/core-spring-memo/assets/js/9.64ef9990.js"><link rel="prefetch" href="/core-spring-memo/assets/js/11.ea2acceb.js"><link rel="prefetch" href="/core-spring-memo/assets/js/12.71206827.js"><link rel="prefetch" href="/core-spring-memo/assets/js/13.5028e7ac.js"><link rel="prefetch" href="/core-spring-memo/assets/js/14.3ceaa2ec.js"><link rel="prefetch" href="/core-spring-memo/assets/js/15.e62f9edd.js"><link rel="prefetch" href="/core-spring-memo/assets/js/16.40b501ab.js">
    <link rel="stylesheet" href="/core-spring-memo/assets/css/0.styles.4a7dcf21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/core-spring-memo/" class="home-link router-link-active"><!----> <span class="site-name">Core Spring Memo</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div> <a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div> <a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Contents</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/core-spring-memo/contents/" class="sidebar-link">はじめに</a></li><li><a href="/core-spring-memo/contents/1_di.html" class="sidebar-link">Spring Conteiner, Dependency Injection</a></li><li><a href="/core-spring-memo/contents/2_aop.html" class="sidebar-link">Aspect oriented programming</a></li><li><a href="/core-spring-memo/contents/3_data-management.html" class="sidebar-link">JDBC, Transactions, JPA, Spring Data</a></li><li><a href="/core-spring-memo/contents/4_spring-boot.html" class="sidebar-link">Spring Boot</a></li><li><a href="/core-spring-memo/contents/5_mvc.html" class="active sidebar-link">Spring MVC and the Web Layer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#spring-mvcについて" class="sidebar-link">Spring MVCについて</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#dispatcherservletとは" class="sidebar-link">DispatcherServletとは</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#web-application-contextとdispatcherservlet" class="sidebar-link">web application contextとDispatcherServlet</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#controllerクラスの定義" class="sidebar-link">Controllerクラスの定義</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#requestmappingとは" class="sidebar-link">@RequestMappingとは</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#requestパラメータの取得" class="sidebar-link">Requestパラメータの取得</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#urlの一部を引数に取る" class="sidebar-link">URLの一部を引数に取る</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#requestparamと-pathvariableの違い" class="sidebar-link">@RequestParamと@PathVariableの違い</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#requestparamと-pathvariableの事例" class="sidebar-link">@RequestParamと@PathVariableの事例</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#viewとしてサポートしているもの" class="sidebar-link">Viewとしてサポートしているもの</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#viewresolver" class="sidebar-link">ViewResolver</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#spring-bootでspring-mvcを使う場合" class="sidebar-link">Spring BootでSpring MVCを使う場合</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#enablewebmvc" class="sidebar-link">@EnableWebMvc</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#静的ファイルの扱い（画像データ、cssファイルなどなど）" class="sidebar-link">静的ファイルの扱い（画像データ、CSSファイルなどなど）</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/5_mvc.html#wip-積み残し課題-重要度低" class="sidebar-link">[WIP] 積み残し課題(重要度低)</a></li></ul></li><li><a href="/core-spring-memo/contents/6_security.html" class="sidebar-link">Security</a></li><li><a href="/core-spring-memo/contents/7_rest.html" class="sidebar-link">REST</a></li><li><a href="/core-spring-memo/contents/8_testing.html" class="sidebar-link">Testing</a></li><li><a href="/core-spring-memo/contents/9_react.html" class="sidebar-link">React</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="spring-mvc-and-the-web-layer"><a href="#spring-mvc-and-the-web-layer" aria-hidden="true" class="header-anchor">#</a> Spring MVC and the Web Layer</h1> <h2 id="spring-mvcについて"><a href="#spring-mvcについて" aria-hidden="true" class="header-anchor">#</a> Spring MVCについて</h2> <ul><li>MVCとは、<code>Model/View/Controller</code>の略。</li> <li>Spring MVCは、Controllerの部分のみを提供している。</li> <li>Front controllerパターンを採用している。</li></ul> <h3 id="spring-mvcの特徴"><a href="#spring-mvcの特徴" aria-hidden="true" class="header-anchor">#</a> Spring MVCの特徴</h3> <ul><li>POJOプログラミング</li> <li>Testしやすい（Testable）</li> <li>設定にはJava Configを利用</li></ul> <h3 id="view部分の実装"><a href="#view部分の実装" aria-hidden="true" class="header-anchor">#</a> View部分の実装</h3> <p>サーバーサイドレンダリング（Viewの部分）として以下のものをサポートしている（他にもある）。</p> <ul><li>Thymeleaf</li> <li>FreeMarker</li> <li>JSP</li> <li>PDF</li> <li>Excel</li></ul> <h2 id="dispatcherservletとは"><a href="#dispatcherservletとは" aria-hidden="true" class="header-anchor">#</a> DispatcherServletとは</h2> <p>SpringにおけるDispatcher Servletとは、すべてのRequestを受け取り、Controllerに処理を振り分ける役割をしている（Front Controllerとも呼ばれる）。</p> <p><img src="/core-spring-memo/assets/img/C004_5_Front_controller.f27933ec.png" alt="C004_5_Front_controller.png"></p> <p>Dispatcher Servletクラスは、受け取ったRequestをもとに各Controller（ビジネスロジック）に処理を割り振り、Modelを受け取る。
受け取ったModelをもとに、View（JSPやThymeLeafなど）をサーバーサイドでレンダリングし、Responseとして返す。</p> <p>このように、SpringではWeb Layerをできるだけ薄くし、関心事（ビジネスロジックとViewのレンダリング）の分離を行っている。</p> <p><img src="/core-spring-memo/assets/img/C003_5_Dispatcher_servlet.e7a2f31a.png" alt="C003_5_Dispatcher_servlet.png"></p> <h2 id="web-application-contextとdispatcherservlet"><a href="#web-application-contextとdispatcherservlet" aria-hidden="true" class="header-anchor">#</a> web application contextとDispatcherServlet</h2> <p>WebApplicationContextはApplicationContextを継承したクラスであり、</p> <ul><li>Requestスコープ</li> <li>Sessionスコープ</li></ul> <p>がサポートされている。</p> <p>DispatcherServletによってWebApplicationContext（ViewResolver、View、Controllerインスタンスを含む）が呼び出される。</p> <p><img src="/core-spring-memo/assets/img/C005_5_WebApplicationContext.31e00080.png" alt="C005_5_WebApplicationContext.png"></p> <p>Spring Bootでは設定済みのDispacherServletが使われるので、開発者側で独自に用意する必要はない。</p> <h3 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h3> <p><a href="https://docs.spring.io/spring/docs/5.0.7.RELEASE/spring-framework-reference/web.html#mvc-servlet-context-hierarchy" target="_blank" rel="noopener noreferrer">Spring Web MVC - 1.2.1. Context Hierarchy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html#DispatcherServlet-org.springframework.web.context.WebApplicationContext-" target="_blank" rel="noopener noreferrer">org.springframework.web.servlet - Class DispatcherServlet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://stackoverflow.com/questions/11708967/what-is-the-difference-between-applicationcontext-and-webapplicationcontext-in-s" target="_blank" rel="noopener noreferrer">What is the difference between ApplicationContext and WebApplicationContext in Spring MVC?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="controllerクラスの定義"><a href="#controllerクラスの定義" aria-hidden="true" class="header-anchor">#</a> Controllerクラスの定義</h2> <h3 id="controllerと-getmapping-requestmappingの仲間"><a href="#controllerと-getmapping-requestmappingの仲間" aria-hidden="true" class="header-anchor">#</a> @Controllerと@GetMapping(@RequestMappingの仲間)</h3> <p>Controllerクラスに、<code>@Controller</code>アノテーションをつける。<br>
特定のURLでHTTP GET Requestが送られてきたときに、処理を受け渡すメソッドに対して<code>@GetMapping</code>アノテーションをつける（URLと処理（メソッド）の紐づけ）。</p> <p>このとき、完全なパスが<code>http://localhost:8080/listAccounts</code>だったとすると、論理パスである<code>/listAccounts</code>を<code>@GetMapping</code>で定義する。</p> <p>Dispatcher Servletが受け取ったRequestを論理パスをもとに、処理を特定のメソッドに振り分けてくれる。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/listAccounts&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">list</span><span class="token punctuation">(</span>Model model<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>論理パスには、ワイルドカードをつけてURLを指定することもできる。<br>
以下にURLの例をいくつか示す。</p> <div class="language- extra-class"><pre class="language-text"><code>– /accounts
– /accounts/edit
– /editAccount
– /accounts/*
</code></pre></div><p>デフォルトでは、<code>.html</code>のようなSuffixは無視される。</p> <div class="language- extra-class"><pre class="language-text"><code>– /listAccounts.html
</code></pre></div><h2 id="requestmappingとは"><a href="#requestmappingとは" aria-hidden="true" class="header-anchor">#</a> @RequestMappingとは</h2> <p>@RequestMappingを使ってURLと処理（メソッド）の紐づけをする場合、GET、POST、PUT、DELETEのいずれかを指定する必要があった。</p> <p>Spring v4.3以降では、GET、POST、PUT、DELETEの役割を持つ<code>@RequestMapping</code>の代替となるアノテーションが追加された。</p> <div class="language- extra-class"><pre class="language-text"><code>– @GetMapping
– @PostMapping
– @PutMapping
– @DeleteMapping
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">推奨</p> <p>基本的に上記の４つを使ってURLと処理（メソッド）の紐づけをControllerクラス内で行う。</p></div> <h2 id="requestパラメータの取得"><a href="#requestパラメータの取得" aria-hidden="true" class="header-anchor">#</a> Requestパラメータの取得</h2> <h3 id="requestparam"><a href="#requestparam" aria-hidden="true" class="header-anchor">#</a> @RequestParam</h3> <p><code>@RequestParam</code>アノテーションでRequestパラメータを引数として取得する。
以下の例は、<code>http://localhost:8080/showAccount.htm?entityId=123</code>をRequestとして受け取った例。引数のidには<code>123</code>が格納される。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/showAccount&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;entityId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> Model model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        … <span class="token comment">// 何らかの処理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="urlの一部を引数に取る"><a href="#urlの一部を引数に取る" aria-hidden="true" class="header-anchor">#</a> URLの一部を引数に取る</h2> <h3 id="pathvariable"><a href="#pathvariable" aria-hidden="true" class="header-anchor">#</a> @PathVariable</h3> <p><code>@PathVariable</code>アノテーションでURLの一部を引数に取ることができる。<br>
以下の例は、<code>http://localhost:8080/accounts/123</code>をRequestとして受け取った例。引数のidには<code>123</code>が格納される。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/accounts/{accountId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;accountId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> Model model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        … <span class="token comment">// 何らかの処理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="もっとシンプルに書く"><a href="#もっとシンプルに書く" aria-hidden="true" class="header-anchor">#</a> もっとシンプルに書く</h3> <p>URLの<code>{accountId}</code>と引数の<code>accountId</code>の名称を一致させることで、以下のようにも記述できる。こちらのほうがシンプル。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/accounts/{accountId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> accountId<span class="token punctuation">,</span> Model model<span class="token punctuation">)</span>
</code></pre></div><p>注意点として、コンパイル時に、</p> <div class="language- extra-class"><pre class="language-text"><code>javac -parameters
</code></pre></div><p>と<code>-parameters</code>を付ける必要がある(JDK 8+が条件)。<br>
Javaはデフォルト設定でコンパイルすると、引数が<code>var1</code>、<code>var2</code>のような適当な変数名に置換されてしまうため、上記で説明した方法がうまく動かない。</p> <p>ちなみに、Spring Bootではデフォルトで上記の設定になっているので、気にする必要がない。</p> <h2 id="requestparamと-pathvariableの違い"><a href="#requestparamと-pathvariableの違い" aria-hidden="true" class="header-anchor">#</a> @RequestParamと@PathVariableの違い</h2> <p>パラメータとして値を渡すか、URLの一部に値を組み込んで渡すかの違い。<br>
リクエストパラメータに特定の値をもたせるよりも、パスに特定の値をもたせたほうがシンプル。</p> <h2 id="requestparamと-pathvariableの事例"><a href="#requestparamと-pathvariableの事例" aria-hidden="true" class="header-anchor">#</a> @RequestParamと@PathVariableの事例</h2> <h3 id="http-localhost-8080-accounts"><a href="#http-localhost-8080-accounts" aria-hidden="true" class="header-anchor">#</a> http://localhost:8080/accounts</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/accounts&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> Model model<span class="token punctuation">)</span>
</code></pre></div><h3 id="http-orders-1234-items-2"><a href="#http-orders-1234-items-2" aria-hidden="true" class="header-anchor">#</a> http://.../orders/1234/items/2</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/orders/{id}/items/{itemId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>“id”<span class="token punctuation">)</span> Long orderId<span class="token punctuation">,</span>
                   <span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">int</span> itemId<span class="token punctuation">,</span>
                   Model model<span class="token punctuation">,</span> Locale locale<span class="token punctuation">,</span>
                   <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span>“user<span class="token operator">-</span>agent”<span class="token punctuation">)</span> String agent <span class="token punctuation">)</span>
</code></pre></div><h3 id="http-orders-orderid-1234-item-2"><a href="#http-orders-orderid-1234-item-2" aria-hidden="true" class="header-anchor">#</a> http://.../orders?orderId=1234&amp;item=2</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/orders&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> Long orderId<span class="token punctuation">,</span>
                   <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>“item”<span class="token punctuation">)</span> <span class="token keyword">int</span> itemId<span class="token punctuation">,</span>
                   Principal user<span class="token punctuation">,</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token punctuation">&gt;</span></span> model<span class="token punctuation">,</span>
                   HttpSession session <span class="token punctuation">)</span>
</code></pre></div><h2 id="viewとしてサポートしているもの"><a href="#viewとしてサポートしているもの" aria-hidden="true" class="header-anchor">#</a> Viewとしてサポートしているもの</h2> <p>Viewとは、Webブラウザに出力するHTMLをレンダリングする部分。</p> <p>Spring MVCがサポートするViewは以下の通り。</p> <ul><li>Thymeleaf</li> <li>FreeMarker</li> <li>JSP</li> <li>PDF</li> <li>Excel</li></ul> <p>などなど。<br>
基本的に、Spring MVCは上記のViewをサーバサイドレンダリングしている。</p> <div class="tip custom-block"><p class="custom-block-title">推奨</p> <p>Thymeleafが75%シェアでおすすめ。次に、FreeMarkerがよく使われている。</p></div> <div class="warning custom-block"><p class="custom-block-title">警告</p> <p>JSPはクロスサイトスクリプティングの脆弱性を持つので、新規の開発では用いない。</p></div> <h2 id="viewresolver"><a href="#viewresolver" aria-hidden="true" class="header-anchor">#</a> ViewResolver</h2> <p>View Resolverインターフェースは、テンプレートエンジンに合わせて用意されている。
論理パスを完全なパスに置換して、DispatcherServletに返す役割を担う。</p> <p>以下に、Mustacheを使った例を示す。<br>
このようにPrefixとSuffixを設定しておく。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> ViewResolver <span class="token function">resolver</span><span class="token punctuation">(</span>Compiler mustacheRuntime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MustacheViewResolver mvr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MustacheViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvr<span class="token punctuation">.</span>setPrefix <span class="token punctuation">(</span> <span class="token string">&quot;classpath:/templates/&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvr<span class="token punctuation">.</span>setSuffix <span class="token punctuation">(</span> <span class="token string">&quot;.html&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mvr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>@xxxMapingアノテーションで指定した論理パスを、ViewResolverが以下のような完全なパスに置換する。</p> <div class="language- extra-class"><pre class="language-text"><code>Prefix + @xxxMappingアノテーションの値 + Suffix
</code></pre></div><h3 id="spring-bootの場合"><a href="#spring-bootの場合" aria-hidden="true" class="header-anchor">#</a> Spring Bootの場合</h3> <p>Spring Bootの場合、以下の例のように<code>application.properties</code>に定義しておく。</p> <div class="language- extra-class"><pre class="language-text"><code>spring.mustache.prefix=classpath:/templates/
spring.mustache.suffix=.html
</code></pre></div><h2 id="spring-bootでspring-mvcを使う場合"><a href="#spring-bootでspring-mvcを使う場合" aria-hidden="true" class="header-anchor">#</a> Spring BootでSpring MVCを使う場合</h2> <h3 id="_1-pom-xmlの定義"><a href="#_1-pom-xmlの定義" aria-hidden="true" class="header-anchor">#</a> 1. pom.xmlの定義</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>デフォルトでTomcatサーバが組み込まれているが、他のものに変更したい場合は以下のように設定する（Jettyに変える場合）。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>fat JARをビルドするのに、以下の設定も必要。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-controllerクラスの設計"><a href="#_2-controllerクラスの設計" aria-hidden="true" class="header-anchor">#</a> 2. Controllerクラスの設計</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RewardController</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> RewardLookupService lookupService<span class="token punctuation">;</span>
    
    <span class="token comment">// ビジネスロジッククラスのインジェクション</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token function">RewardController</span><span class="token punctuation">(</span>RewardLookupService svc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lookupService <span class="token operator">=</span> svc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 論理パスに対応する処理（メソッド）</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rewards/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">show</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> Model model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Reward reward <span class="token operator">=</span> lookupService<span class="token punctuation">.</span><span class="token function">lookupReward</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>“reward”<span class="token punctuation">,</span> reward<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> “rewardView”<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-viewresolverの設定"><a href="#_3-viewresolverの設定" aria-hidden="true" class="header-anchor">#</a> 3. ViewResolverの設定</h3> <p>以下のように、ViewResolverを設定しておく。<br>
以下、Spring Bootのドキュメントから抜粋。</p> <div class="language- extra-class"><pre class="language-text"><code># THYMELEAF (ThymeleafAutoConfiguration)
spring.thymeleaf.prefix=classpath:/templates/ # Prefix that gets prepended to view names when building a URL.
spring.thymeleaf.suffix=.html                 # Suffix that gets appended to view names when building a URL.
</code></pre></div><h3 id="_4-テンプレートviewの用意"><a href="#_4-テンプレートviewの用意" aria-hidden="true" class="header-anchor">#</a> 4. テンプレートViewの用意</h3> <p>テンプレートエンジンによるので割愛。</p> <h2 id="enablewebmvc"><a href="#enablewebmvc" aria-hidden="true" class="header-anchor">#</a> @EnableWebMvc</h2> <p>Spring Bootを使っていない場合、このアノテーションを付けてSpring MVCの設定を行う。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>@EnableXxxはSpringの特定の機能を有効化するものであり、Spring BootではAutoConfiguration用のクラスですべて定義済みである。<br>
そのため、不用意に上記のアノテーションを付けてしまうと、Spring Bootが動かなくなる一因となる。</p></div> <h2 id="静的ファイルの扱い（画像データ、cssファイルなどなど）"><a href="#静的ファイルの扱い（画像データ、cssファイルなどなど）" aria-hidden="true" class="header-anchor">#</a> 静的ファイルの扱い（画像データ、CSSファイルなどなど）</h2> <p>テンプレートViewだと、<code>/src/main/resources/resources/templates</code>直下など使えるパスが決まっている。</p> <h2 id="wip-積み残し課題-重要度低"><a href="#wip-積み残し課題-重要度低" aria-hidden="true" class="header-anchor">#</a> [WIP] 積み残し課題(重要度低)</h2> <ul><li>What are some of the parameter types for a controller method?</li> <li>What other annotations might you use on a controller method parameter? (You can ignore form-handling annotations for this exam)</li> <li>What are some of the valid return types of a controller method?</li> <li>How is the right View chosen when it comes to the rendering phase?</li> <li>Why do you have access to the model in your View? Where does it come from?</li> <li>What is the purpose of the session scope?</li> <li>What is the default scope in the web context?</li> <li>Why are controllers testable artifacts?</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Imamachi-n/core-spring-memo/edit/master/docs/contents/5_mvc.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/22/2018, 7:30:39 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/core-spring-memo/contents/4_spring-boot.html" class="prev">
          Spring Boot
        </a></span> <span class="next"><a href="/core-spring-memo/contents/6_security.html">
          Security
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/core-spring-memo/assets/js/10.06398a2e.js" defer></script><script src="/core-spring-memo/assets/js/app.9728203e.js" defer></script>
  </body>
</html>
