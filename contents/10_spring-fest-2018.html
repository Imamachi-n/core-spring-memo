<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Fest 2018 | Core Spring Memo</title>
    <meta name="description" content="Spring Framework 5.x / Spring Boot 2.x">
    <link rel="icon" href="/core-spring-memo/hero.jpg">
  <link rel="manifest" href="/core-spring-memo/manifest.json">
    
    <link rel="preload" href="/core-spring-memo/assets/css/styles.4f7913ec.css" as="style"><link rel="preload" href="/core-spring-memo/assets/js/app.4f7913ec.js" as="script"><link rel="preload" href="/core-spring-memo/assets/js/10.60c243d2.js" as="script"><link rel="prefetch" href="/core-spring-memo/assets/css/2.styles.2caa8aac.css"><link rel="prefetch" href="/core-spring-memo/assets/css/7.styles.508aba4a.css"><link rel="prefetch" href="/core-spring-memo/assets/js/1.624555d1.js"><link rel="prefetch" href="/core-spring-memo/assets/js/11.64c0278f.js"><link rel="prefetch" href="/core-spring-memo/assets/js/12.a5afd118.js"><link rel="prefetch" href="/core-spring-memo/assets/js/13.ee2e376e.js"><link rel="prefetch" href="/core-spring-memo/assets/js/14.5ebb0069.js"><link rel="prefetch" href="/core-spring-memo/assets/js/15.716a0bf0.js"><link rel="prefetch" href="/core-spring-memo/assets/js/16.234cf1d1.js"><link rel="prefetch" href="/core-spring-memo/assets/js/2.2caa8aac.js"><link rel="prefetch" href="/core-spring-memo/assets/js/3.604bb3ed.js"><link rel="prefetch" href="/core-spring-memo/assets/js/4.df286d25.js"><link rel="prefetch" href="/core-spring-memo/assets/js/5.49c8c5e3.js"><link rel="prefetch" href="/core-spring-memo/assets/js/6.0ad2e671.js"><link rel="prefetch" href="/core-spring-memo/assets/js/7.508aba4a.js"><link rel="prefetch" href="/core-spring-memo/assets/js/8.baaadea4.js"><link rel="prefetch" href="/core-spring-memo/assets/js/9.7f5844f1.js">
    <link rel="stylesheet" href="/core-spring-memo/assets/css/2.styles.2caa8aac.css"><link rel="stylesheet" href="/core-spring-memo/assets/css/7.styles.508aba4a.css"><link rel="stylesheet" href="/core-spring-memo/assets/css/styles.4f7913ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/core-spring-memo/" class="home-link router-link-active"><!----> <span class="site-name">Core Spring Memo</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div> <a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div> <a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Contents</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/core-spring-memo/contents/" class="sidebar-link">はじめに</a></li><li><a href="/core-spring-memo/contents/1_di.html" class="sidebar-link">Spring Conteiner, Dependency Injection</a></li><li><a href="/core-spring-memo/contents/2_aop.html" class="sidebar-link">Aspect oriented programming</a></li><li><a href="/core-spring-memo/contents/3_data-management.html" class="sidebar-link">JDBC, Transactions, JPA, Spring Data</a></li><li><a href="/core-spring-memo/contents/4_spring-boot.html" class="sidebar-link">Spring Boot</a></li><li><a href="/core-spring-memo/contents/5_mvc.html" class="sidebar-link">Spring MVC and the Web Layer</a></li><li><a href="/core-spring-memo/contents/6_security.html" class="sidebar-link">Security</a></li><li><a href="/core-spring-memo/contents/7_rest.html" class="sidebar-link">REST</a></li><li><a href="/core-spring-memo/contents/8_testing.html" class="sidebar-link">Testing</a></li><li><a href="/core-spring-memo/contents/9_react.html" class="sidebar-link">React</a></li><li><a href="/core-spring-memo/contents/10_spring-fest-2018.html" class="active sidebar-link">Spring Fest 2018</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#the-state-of-spring-java-and-kotlin" class="sidebar-link">The State of Spring, Java and Kotlin.</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#hall-決済システムの内製化への旅-spring-と-pcf-で作るクラウドネイティブなシステム開発" class="sidebar-link">Hall: 決済システムの内製化への旅 - Spring と PCF で作るクラウドネイティブなシステム開発</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#手に入れたアプリケーション構成" class="sidebar-link">手に入れたアプリケーション構成</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#annex-spring-♥-gcp-ー-spring-と-gcp-の素敵な関係" class="sidebar-link">Annex: Spring ♥ GCP ー Spring と GCP の素敵な関係</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#hall-knative-serving-your-serverless-java-service-on-kubernetes-the-12-factor-way" class="sidebar-link">Hall: Knative: Serving your Serverless Java Service on Kubernetes the 12-Factor way</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/10_spring-fest-2018.html#hall-pivotal-認定講師が解説！基礎からの-oauth-2-0-と-spring-security-5-1-による実装" class="sidebar-link">Hall: Pivotal 認定講師が解説！基礎からの OAuth 2.0 と Spring Security 5.1 による実装</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="spring-fest-2018"><a href="#spring-fest-2018" aria-hidden="true" class="header-anchor">#</a> Spring Fest 2018</h1> <h2 id="the-state-of-spring-java-and-kotlin"><a href="#the-state-of-spring-java-and-kotlin" aria-hidden="true" class="header-anchor">#</a> The State of Spring, Java and Kotlin.</h2> <p>###GraalVM
JVM 言語だけでなく、Python, Ruby といったスクリプト言語や C や C++といった LLVM を実行できる共通ランタイム。
Spring Boot の実行デモでは、JVM 上と比較してかなり早い印象（0.005-0.006）。</p> <h3 id="r2dbc"><a href="#r2dbc" aria-hidden="true" class="header-anchor">#</a> R2DBC</h3> <p>Reactive Relational Database Connectivity
Minimal dricer SPI
Spring Data R2DBC</p> <p>Similar tothe new Spring data jdbc project but for reactive.
Databaseclient functinoal API
repository pattern support
来年提供される。</p> <h3 id="rsocket"><a href="#rsocket" aria-hidden="true" class="header-anchor">#</a> RSocket</h3> <p>reactive streams back pressure over the network</p> <h3 id="spring-fu"><a href="#spring-fu" aria-hidden="true" class="header-anchor">#</a> Spring Fu</h3> <p>Spring Fu is an incubator inteneded to mature experimental features before release (Spring boot etx...).
faster and lighter spring boot using Functional beans(Netty vs functional)</p> <h3 id="jafu-confuguration"><a href="#jafu-confuguration" aria-hidden="true" class="header-anchor">#</a> jafu confuguration</h3> <p>Java</p> <h3 id="kofu-configuration"><a href="#kofu-configuration" aria-hidden="true" class="header-anchor">#</a> Kofu configuration</h3> <p>Kotlin</p> <h2 id="hall-決済システムの内製化への旅-spring-と-pcf-で作るクラウドネイティブなシステム開発"><a href="#hall-決済システムの内製化への旅-spring-と-pcf-で作るクラウドネイティブなシステム開発" aria-hidden="true" class="header-anchor">#</a> Hall: 決済システムの内製化への旅 - Spring と PCF で作るクラウドネイティブなシステム開発</h2> <h3 id="内製化に至る道のり"><a href="#内製化に至る道のり" aria-hidden="true" class="header-anchor">#</a> 内製化に至る道のり</h3> <p>Spring boot, Selenium/Selenide
Github, Jira, Confluence, Slack</p> <p>サービス監視の質を高める
ElastichSearch
Kibana
など。</p> <p>開発プロジェクトの支援を開始。古いアーキテクチャを刷新。
spring boot, cloud
Jenkins, Nexus, sonarqube</p> <h3 id="開発対象・オンライン決済サービス"><a href="#開発対象・オンライン決済サービス" aria-hidden="true" class="header-anchor">#</a> 開発対象・オンライン決済サービス</h3> <p>新システムに求めるもの</p> <ul><li>スピード感のある開発・リリース</li> <li>継続的な改善のサイクル</li> <li>監視が用意で障害に強いシステム</li></ul> <p>開発ベンダに頼り切っていてはスピード感のある開発ができない。
→ 内製化へ</p> <p>導入したもの
Pivotal Cloud Foundry</p> <h3 id="pivotal-cloud-foundry-を導入した理由"><a href="#pivotal-cloud-foundry-を導入した理由" aria-hidden="true" class="header-anchor">#</a> Pivotal Cloud Foundry を導入した理由</h3> <p>Kubernetes を支援する Pivotal Container Service。
OS image, Runtime Layer, Service Brokerage, Application Layer を作る</p> <p>アプリを実行する環境をプラットフォームを使って、Pivotal Application Service
Application Layer のみを作る
→ 抽象化レイヤーの違い</p> <p>各設定がプラットフォーム側で自動で行われる（テスト、ビルド、ロードバランサ、ファイアウォール、モニタリングツール、ロギングなどの設定）。
→ デプロイのスピードが早くなる。</p> <p>プラットフォーム運用者：プラットフォームの構築・管理に専念。
アプリケーション開発者：業務の設計・実装に集中。</p> <p>12 Factor App：ベンダーロックインされない。他のプラットフォームでも動くアプリを作れる。
→Pivotal が技術支援。</p> <h3 id="paas-vs-kubernetes"><a href="#paas-vs-kubernetes" aria-hidden="true" class="header-anchor">#</a> PaaS vs Kubernetes</h3> <p>Pivotal Cloud Foundry を使うことで、開発にフォーカスしたい。
PaaS だと、やることが制限されている分、開発に集中できる。</p> <p>Kubernetes だと、なんでもできる分、管理などがややこしくなる。</p> <p>Concourse
Nexus
RabbitMQ
Grafana
などなど</p> <h2 id="手に入れたアプリケーション構成"><a href="#手に入れたアプリケーション構成" aria-hidden="true" class="header-anchor">#</a> 手に入れたアプリケーション構成</h2> <p>API Gateway を使ってる（Spring Cloud Gateway で実装）。
すべてのアプリは Spring boot で実装。</p> <p>ある REST API で障害が起こった場合、障害の伝播により API Gateway が障害を起こし、
他のサービスにも影響が出る。</p> <p>Circuit Breaker を実装。</p> <p>システム間通信は、Hystrix を使うことで、上記の問題をクリア。
スレッドの枯渇を防ぐ。</p> <p>Spring Cloud Stream を使って、非同期でメッセージをキューイング。
Notification Gateway から、加盟店に対して、通知処理が届く。
Dead Error Queue を投げて、リソースの枯渇を防ぐ。</p> <p>負荷がかかった場合、Cloud Foundy 側で、自動で App インスタンスを増やせる。
スケールのルール設定を GUI で作ることができる。
スケールイン・アウトも容易に可能。</p> <h3 id="アプリ実装の観点で重要な-5-factors"><a href="#アプリ実装の観点で重要な-5-factors" aria-hidden="true" class="header-anchor">#</a> アプリ実装の観点で重要な 5 Factors</h3> <ul><li>Config: 環境に依存する設定項目を環境変数に格納</li> <li>Processes, port binding, concurrency：CF, Spring boot がやってくれる。</li> <li>logs：ログは標準出力しておけば、CF が拾ってくれる。</li></ul> <h3 id="concourse-ci"><a href="#concourse-ci" aria-hidden="true" class="header-anchor">#</a> Concourse CI</h3> <p>CI ツール。ビルド・デプロイパイプラインの構築。
実行環境は Docker イメージで用意。
ジョブの設定は、YAML ファイルで設定。
Maven, JUnit5, sonarqube を実行後, Nexus にアップロード、CF にアプリ展開。</p> <h3 id="jmeter-による負荷テスト、e2e-テスト（html-レポート）"><a href="#jmeter-による負荷テスト、e2e-テスト（html-レポート）" aria-hidden="true" class="header-anchor">#</a> JMeter による負荷テスト、E2E テスト（HTML レポート）</h3> <p>開発中は JMeter によるテストを毎日継続的に自動で実行。
レポートのスクリーンショットを Slack でメンバーに共有。</p> <h3 id="java-の複数バージョンでのユニットテスト"><a href="#java-の複数バージョンでのユニットテスト" aria-hidden="true" class="header-anchor">#</a> Java の複数バージョンでのユニットテスト</h3> <p>それぞれの Java の Docker イメージを用意して、並列でテスト。
次期バージョンでも動作するかどうか、早い段階でテストしておく。
⇒Java アップデートの弊害を早期に検知できるように。</p> <h3 id="java-の更新についていく-攻めこそ最大の守り"><a href="#java-の更新についていく-攻めこそ最大の守り" aria-hidden="true" class="header-anchor">#</a> Java の更新についていく - 攻めこそ最大の守り</h3> <p>簡単にデプロイ可能な開発・本番環境（Dev/Staging/Prod）を用意すること。
塩漬けするのではなく、アップデートし続けられる環境を準備。</p> <h3 id="observability"><a href="#observability" aria-hidden="true" class="header-anchor">#</a> Observability</h3> <p>Metrics（Micrometer, Grafana, Prometeus）, Tracing（Zipkin）, Logging（Kibana） の３つの観点から監視。
⇒ しきい値を超えると、Slack に通知される。
⇒ Spring 側は、１つの依存ライブラリを追加するだけで OK。
⇒ アプリケーションログなどを収集。</p> <p>⇒ Zipkin でトレース ID から検索が容易に。
⇒ 実行された SQL の実行時間などを調べることもできる。</p> <p>外注に頼り切ったサービス開発を積み重ねてもプラットフォームを維持できない。</p> <h2 id="annex-spring-♥-gcp-ー-spring-と-gcp-の素敵な関係"><a href="#annex-spring-♥-gcp-ー-spring-と-gcp-の素敵な関係" aria-hidden="true" class="header-anchor">#</a> Annex: Spring ♥ GCP ー Spring と GCP の素敵な関係</h2> <p>GAE と GKE の使い方について</p> <h3 id="gcp-を使うメリット"><a href="#gcp-を使うメリット" aria-hidden="true" class="header-anchor">#</a> GCP を使うメリット</h3> <p>Google の SRE（サービスが動くことを保証する部門）がサービスを守ってくれる（スケール・インフラ力）。
AWS や Azure と違うところは、「ネットワーク」。Google のサービスで使っているシステム向けに作った
内製化したサービスを GCP で使える。</p> <h3 id="java-を-gcp-で使う上で使うサービス"><a href="#java-を-gcp-で使う上で使うサービス" aria-hidden="true" class="header-anchor">#</a> Java を GCP で使う上で使うサービス</h3> <p>GCE: Compute Engine（VM）
GKE: Kubernetes Engine
GAE: App Engine</p> <h3 id="app-engine"><a href="#app-engine" aria-hidden="true" class="header-anchor">#</a> App Engine</h3> <p>コードを書いてデプロイするだけのアプリケーション実行基盤（PaaS）
コードファースト:開発者にアプリケーションに専念してもらい、システム構築、管理負荷を最小化する。
No-Ops: 可用性とスケーラビリティはプラットフォームに組み込まれている。
運用ツール: バージョンコントロールやトラフィックスプリットといった運用ツールが含まれている。</p> <h4 id="フレキシブル環境"><a href="#フレキシブル環境" aria-hidden="true" class="header-anchor">#</a> フレキシブル環境</h4> <p>サポート言語:
Java8, Python, Node.js, Ruby, PHP, .NET.core, Go
カスタム環境: Docker
カスタマイズが効くが、立ち上がりに時間がかかる。
スケーリングができない…。</p> <h4 id="スタンダード環境"><a href="#スタンダード環境" aria-hidden="true" class="header-anchor">#</a> スタンダード環境</h4> <p>使えるライブラリに制限がある。
サンドボックス。</p> <h4 id="スタンダード環境（第二世代）"><a href="#スタンダード環境（第二世代）" aria-hidden="true" class="header-anchor">#</a> スタンダード環境（第二世代）</h4> <p>オープンソース、Idiomatic experience（他の環境でも同じ体験をできるように）
GCP 固有の設定や制限がないように設計されている。
サポートランタイム：Java, Node.js, Python など</p> <p>⇒ スタンダード環境の第二世代を選択するのが良い。</p> <h3 id="spring-boot-アプリを-app-engine-にデプロイ（デモ）"><a href="#spring-boot-アプリを-app-engine-にデプロイ（デモ）" aria-hidden="true" class="header-anchor">#</a> Spring Boot アプリを App Engine にデプロイ（デモ）</h3> <p>Spring Boot のパッケージを WAR にする（ランタイムに Jetty を使っている関係）。
Spring Cloud で GCP サポートも受けられる（Pivotal と Google の協業）。
⇒ 現時点では、設定ファイルをプロジェクトに組み込む必要がある。</p> <ol><li>App Engine のプラグインを導入する。</li> <li>App Engine の設定ファイルを作る（appengine-app.xml）。</li> <li>App Engine へデプロイ</li></ol> <div class="language- extra-class"><pre class="language-text"><code>./mvnw appengine:deploy
</code></pre></div><h4 id="バージョンスプリッティング"><a href="#バージョンスプリッティング" aria-hidden="true" class="header-anchor">#</a> バージョンスプリッティング</h4> <p>アップデート後に、システムを止めることなくバーションが切り替わる。</p> <h4 id="トラフィックスプリッティング"><a href="#トラフィックスプリッティング" aria-hidden="true" class="header-anchor">#</a> トラフィックスプリッティング</h4> <p>トラフィックを振り分けてくれる。
アプリ Ver1 と Ver2 で例えば５０％ごとに振り分けたり。</p> <h4 id="オートスケール"><a href="#オートスケール" aria-hidden="true" class="header-anchor">#</a> オートスケール</h4> <p>負荷がかかるとインスタンスが増える（VM と比較して、圧倒的に速いスピードでスケールする）。
デモでは、すぐに９つのインスタンスが立ち上がっていた。
課金の面でも、VM と比較して節約できる（App Engine だと VM と比較して、使われていないインスタンスがすぐにスケールダウンするため）。</p> <h3 id="kubernetes-engine"><a href="#kubernetes-engine" aria-hidden="true" class="header-anchor">#</a> Kubernetes Engine</h3> <p>Kubernetes は、Google 社内のコンテナオーケストレータをもとに作られた OSS。
デファクトスタンダード。
Write Once, Run Anywhere。</p> <h4 id="google-kubernetes-engine-gke"><a href="#google-kubernetes-engine-gke" aria-hidden="true" class="header-anchor">#</a> Google Kubernetes Engine(GKE)</h4> <p>Zero-Ops クラスタを目指す。
簡単、信頼性が高い、効率性が高い。</p> <p>Master ノードの下に、Nodepool を持つ構造。</p> <p>ネットワークの構成や設定ファイルを作ることなく、立ち上げることができる（起動は App Engine よりもかなり遅い）。
K8s では、pods という単位で Docker コンテナが管理されている。</p> <h3 id="終わりに"><a href="#終わりに" aria-hidden="true" class="header-anchor">#</a> 終わりに</h3> <p>App Engine は無料枠があるので、テストに使える。</p> <h2 id="hall-knative-serving-your-serverless-java-service-on-kubernetes-the-12-factor-way"><a href="#hall-knative-serving-your-serverless-java-service-on-kubernetes-the-12-factor-way" aria-hidden="true" class="header-anchor">#</a> Hall: Knative: Serving your Serverless Java Service on Kubernetes the 12-Factor way</h2> <p>今日の資料
@kamesh_sampath bit.ly/knserving</p> <h3 id="serverless-computing"><a href="#serverless-computing" aria-hidden="true" class="header-anchor">#</a> Serverless computing</h3> <p>24 時間監視する必要のないアプリケーションを作成する。
AWS Lambda が有名な例。</p> <h3 id="なぜ-serverless-化なのか"><a href="#なぜ-serverless-化なのか" aria-hidden="true" class="header-anchor">#</a> なぜ Serverless 化なのか?</h3> <ul><li>Agility</li> <li>Event Driven</li> <li>Focus on business differentiation</li> <li>consistent and scalable operations
リソースの最適化と cost saving。</li></ul> <h3 id="architectural-evolution"><a href="#architectural-evolution" aria-hidden="true" class="header-anchor">#</a> Architectural evolution</h3> <ul><li>Service</li> <li>Microservice</li> <li>Function</li></ul> <p>Microservice と Function の違いはなんなのか？</p> <h3 id="利点"><a href="#利点" aria-hidden="true" class="header-anchor">#</a> 利点</h3> <ul><li>AUtomatic scalability</li> <li>automatic cost redution</li> <li>quicker and easier development</li> <li>better capacity utilization</li> <li>deploy speed</li></ul> <h3 id="欠点"><a href="#欠点" aria-hidden="true" class="header-anchor">#</a> 欠点</h3> <ul><li>Debugging</li> <li>deployment and architectural complexity</li> <li>vendor lock-in</li> <li>monitoring</li> <li>learning curve</li></ul> <h3 id="serverless-vs-faas"><a href="#serverless-vs-faas" aria-hidden="true" class="header-anchor">#</a> Serverless vs FaaS</h3> <p>Event fires and then your code runs, serve services.</p> <h3 id="faas-kunernetes-players"><a href="#faas-kunernetes-players" aria-hidden="true" class="header-anchor">#</a> FaaS Kunernetes players</h3> <ul><li>kubeless</li> <li>openWhisk</li> <li>ruff</li></ul> <h3 id="function-as-a-service"><a href="#function-as-a-service" aria-hidden="true" class="header-anchor">#</a> Function as a Service</h3> <p>OS, Data, Application を必要としない。
Bussiness Logic のみで OK（イベント駆動のイメージ）。</p> <h3 id="knative"><a href="#knative" aria-hidden="true" class="header-anchor">#</a> Knative</h3> <p>Kubernates based platform to build, deploy and manage modern serverless workloads.
Run anywhere on premises, in the cloud or even in a third-party data center.</p> <h4 id="serving"><a href="#serving" aria-hidden="true" class="header-anchor">#</a> serving</h4> <ul><li>building and running applications(k8s)</li> <li>no server management(k8s)</li> <li>fine grained deployment model(Knative)</li> <li>executed, scaled and billed in response to the exact demand.(k8s)</li></ul> <p>automatically scale down to zero...</p> <h4 id="build"><a href="#build" aria-hidden="true" class="header-anchor">#</a> build</h4> <p>Knative pull sources, refer build templates and then push images to container repo.
knative also pull images from repo and then rollout new revision.</p> <h4 id="cncf-cloudevents-and-serverless"><a href="#cncf-cloudevents-and-serverless" aria-hidden="true" class="header-anchor">#</a> CNCF, cloudevents and Serverless</h4> <h4 id="eventing"><a href="#eventing" aria-hidden="true" class="header-anchor">#</a> Eventing</h4> <h3 id="ブログ"><a href="#ブログ" aria-hidden="true" class="header-anchor">#</a> ブログ</h3> <p>今日の内容を「Knative configuration routes and revisions.」でまとめている。
まだ安定していない？</p> <h3 id="無料の-e-bbok"><a href="#無料の-e-bbok" aria-hidden="true" class="header-anchor">#</a> 無料の e-bbok</h3> <p>bit.ly/mono2microdb
bit.ly/istio-book
bit.ly/javamicroservicesbook
bit.ly/reactivemicroservicesbook
bit.ly/faas-tutorial</p> <h2 id="hall-pivotal-認定講師が解説！基礎からの-oauth-2-0-と-spring-security-5-1-による実装"><a href="#hall-pivotal-認定講師が解説！基礎からの-oauth-2-0-と-spring-security-5-1-による実装" aria-hidden="true" class="header-anchor">#</a> Hall: Pivotal 認定講師が解説！基礎からの OAuth 2.0 と Spring Security 5.1 による実装</h2> <h3 id="_1-oauth2-0-の基本用語"><a href="#_1-oauth2-0-の基本用語" aria-hidden="true" class="header-anchor">#</a> 1. OAuth2.0 の基本用語</h3> <p>認可の流れを規定したプロトコル
認証プロトコル OpenID Connect のベースになっている。
OAuth1.0 とは完全に別物。</p> <h4 id="アクセストークン"><a href="#アクセストークン" aria-hidden="true" class="header-anchor">#</a> アクセストークン</h4> <p>サーバのデータにアクセスするための許可書。</p> <h4 id="スコープ"><a href="#スコープ" aria-hidden="true" class="header-anchor">#</a> スコープ</h4> <p>アクセストークンがやれることの範囲。</p> <h4 id="id-とパスワード"><a href="#id-とパスワード" aria-hidden="true" class="header-anchor">#</a> ID とパスワード</h4> <p>パスワードを持っている人が全県を持っている。やりたい放題。
盗まれると被害大きい。</p> <h4 id="oauth2-0"><a href="#oauth2-0" aria-hidden="true" class="header-anchor">#</a> OAuth2.0</h4> <ol><li>リソースオーナー：情報の持ち主。</li> <li>リソースサーバー：情報を保持するサーバ</li> <li>クライアント：リソースサーバからもらった情報を扱うアプリケーション</li> <li>認可サーバ：アクセストークンの発行元。</li></ol> <p>リソースオーナーが認可をクライアントに対して与えると、認可サーバからアクセストークンが付与され、
アプリからサーバにアクセスできるようになる。</p> <h4 id="グラントタイプ（アクセストークンの取得方法）"><a href="#グラントタイプ（アクセストークンの取得方法）" aria-hidden="true" class="header-anchor">#</a> グラントタイプ（アクセストークンの取得方法）</h4> <ul><li>認可コード</li></ul> <h4 id="認可コードとは"><a href="#認可コードとは" aria-hidden="true" class="header-anchor">#</a> 認可コードとは</h4> <p>アクセストークンの引換券
⇒ アクセストークンが Web ブラウザに渡らないようにするため。</p> <ol><li>初回アクセス</li> <li>認可エンドポイントにリダイレクト</li> <li>認可画面を返す</li> <li>認可</li> <li>認可コードの発行＋リダイレクト</li> <li>認可コード</li> <li>アクセストークン（認可サーバからクライアントに）</li></ol> <p>認可コードがブラウザに渡っていないことがポイント。
リフレッシュトークン。</p> <h4 id="oauth2-0-仕様で未定義の部分"><a href="#oauth2-0-仕様で未定義の部分" aria-hidden="true" class="header-anchor">#</a> OAuth2.0 仕様で未定義の部分</h4> <p>どう認可するか決まっていない
⇒ 開発者が作り込む。</p> <p>認可コードを送ってきたのがクライアントかどうか BASIC 認証して判断。</p> <h3 id="_3-アクセストークンを利用したリソースアクセス"><a href="#_3-アクセストークンを利用したリソースアクセス" aria-hidden="true" class="header-anchor">#</a> 3. アクセストークンを利用したリソースアクセス</h3> <ol><li>リソースオーナーがリクエスト。</li> <li>リソースにアクセス（with アクセストークン）</li> <li>アクセストークンの検証</li> <li>ユーザ情報やスコープ</li> <li>スコープをチェック</li> <li>レスポンスを返す</li></ol> <h3 id="アクセストークンやスコープの検証方法"><a href="#アクセストークンやスコープの検証方法" aria-hidden="true" class="header-anchor">#</a> アクセストークンやスコープの検証方法</h3> <ol><li>認可サーバに問い合わせる（BASIC 認証）</li> <li>共有データベースなどを利用する</li> <li>アクセストークン自身に情報を含めておく</li></ol> <h3 id="jwt-json-web-token"><a href="#jwt-json-web-token" aria-hidden="true" class="header-anchor">#</a> JWT(JSON Web Token)</h3> <p>アクセストークン自身にユーザ情報やスコープなどの情報を含めることができる。
ピリオドで３つの部分に分かれる（ヘッダー、ペイロード、電子署名）。</p> <p>ペイロードをデコードすると、JSON が含まれている。</p> <h3 id="署名を利用した-jwt-の検証"><a href="#署名を利用した-jwt-の検証" aria-hidden="true" class="header-anchor">#</a> 署名を利用した JWT の検証</h3> <p>リソースサーバは JWT の署名で検証する。
署名は認可サーバの秘密鍵で暗号化されている。
⇒ 認可サーバの公開鍵で復号化する。</p> <h3 id="jwk-json-web-key"><a href="#jwk-json-web-key" aria-hidden="true" class="header-anchor">#</a> JWK (JSON Web Key)</h3> <p>認可サーバの公開鍵のもととなる情報が含まれた JSON
認可サーバから JWK Set 形式（JWK の配列を含んだ JSON）で取得する。</p> <h3 id="jwt-の弱点と対策"><a href="#jwt-の弱点と対策" aria-hidden="true" class="header-anchor">#</a> JWT の弱点と対策</h3> <p>弱点：アクセストークンの剥奪が不可能
リソースサーバが認可サーバに問い合わせしないため、認可サーバ側での制御が不可能。</p> <p>対策：アクセストークンの有効期限を短くする
だいたい数分間。
リフレッシュトークンで新しいトークンを再取得させる。
⇒POST でトークンエンドポイントにアクセスする。</p> <h3 id="_4-認可サーバの実装"><a href="#_4-認可サーバの実装" aria-hidden="true" class="header-anchor">#</a> 4.認可サーバの実装</h3> <p>Spring Security5.1 まででクライアントとリソースサーバまでしか対応してない。
認可サーバは 5.2 に入るが、部分的な対応になる。</p> <h3 id="認可サーバを作る"><a href="#認可サーバを作る" aria-hidden="true" class="header-anchor">#</a> 認可サーバを作る</h3> <ul><li>認可サーバ機能を持ったサービスを利用する</li> <li>KeyCloak を使う。</li></ul> <h3 id="_5-クライアントの実装"><a href="#_5-クライアントの実装" aria-hidden="true" class="header-anchor">#</a> 5. クライアントの実装</h3> <p>pom.xml
application.yml</p> <h3 id="ログアウト"><a href="#ログアウト" aria-hidden="true" class="header-anchor">#</a> ログアウト</h3> <p>クライアントと認可サーバの両方からログアウトしないといけない。</p> <h3 id="_6-リソースサーバの実装"><a href="#_6-リソースサーバの実装" aria-hidden="true" class="header-anchor">#</a> 6.リソースサーバの実装</h3> <h3 id="oauth2-0-2"><a href="#oauth2-0-2" aria-hidden="true" class="header-anchor">#</a> OAuth2.0</h3> <ul><li>HTTPS 必須</li> <li>認可コードリダイレクトなどなど</li></ul> <h3 id="参考資料"><a href="#参考資料" aria-hidden="true" class="header-anchor">#</a> 参考資料</h3> <ul><li>基礎からの OAuth2.0</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Imamachi-n/core-spring-memo/edit/master/docs/contents/10_spring-fest-2018.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/31/2018, 8:49:37 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/core-spring-memo/contents/9_react.html" class="prev">
          React
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/core-spring-memo/assets/js/10.60c243d2.js" defer></script><script src="/core-spring-memo/assets/js/app.4f7913ec.js" defer></script>
  </body>
</html>
