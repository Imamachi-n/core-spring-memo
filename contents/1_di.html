<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Container, Dependency, and IOC | Core Spring Memo</title>
    <meta name="description" content="Spring Framework 5.x / Spring Boot 2.x">
    <link rel="icon" href="/core-spring-memo/hero.jpg">
  <link rel="manifest" href="/core-spring-memo/manifest.json">
    
    <link rel="preload" href="/core-spring-memo/assets/css/0.styles.32f8bd5f.css" as="style"><link rel="preload" href="/core-spring-memo/assets/js/app.8e8db30d.js" as="script"><link rel="preload" href="/core-spring-memo/assets/js/5.6e32d06f.js" as="script"><link rel="prefetch" href="/core-spring-memo/assets/js/2.c5db5a80.js"><link rel="prefetch" href="/core-spring-memo/assets/js/3.1cf3aff7.js"><link rel="prefetch" href="/core-spring-memo/assets/js/4.f20299e5.js"><link rel="prefetch" href="/core-spring-memo/assets/js/6.aeedf6eb.js"><link rel="prefetch" href="/core-spring-memo/assets/js/7.202038aa.js"><link rel="prefetch" href="/core-spring-memo/assets/js/8.a3b86285.js"><link rel="prefetch" href="/core-spring-memo/assets/js/9.0a2891f4.js"><link rel="prefetch" href="/core-spring-memo/assets/js/10.eb013097.js"><link rel="prefetch" href="/core-spring-memo/assets/js/11.a7c91bcd.js"><link rel="prefetch" href="/core-spring-memo/assets/js/12.2dd2b42a.js"><link rel="prefetch" href="/core-spring-memo/assets/js/13.1bea2342.js"><link rel="prefetch" href="/core-spring-memo/assets/js/14.e368ef4b.js">
    <link rel="stylesheet" href="/core-spring-memo/assets/css/0.styles.32f8bd5f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/core-spring-memo/" class="home-link router-link-active"><!----><span class="site-name">
      Core Spring Memo
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div><a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core-spring-memo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core-spring-memo/about/" class="nav-link">このページについて</a></div><div class="nav-item"><a href="/core-spring-memo/contents/" class="nav-link router-link-active">Springメモ</a></div><div class="nav-item"><a href="/core-spring-memo/handson/" class="nav-link">ハンズオン</a></div><a href="https://github.com/Imamachi-n/core-spring-memo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Contents</span><!----></p><ul class="sidebar-group-items"><li><a href="/core-spring-memo/contents/" class="sidebar-link">はじめに</a></li><li><a href="/core-spring-memo/contents/1_di.html" class="active sidebar-link">Container, Dependency, and IOC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#dependency-injectionとその利点" class="sidebar-link">Dependency Injectionとその利点</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#パターン・アンチパターンとは。diとはパターンなのか？" class="sidebar-link">パターン・アンチパターンとは。DIとはパターンなのか？</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#インターフェイスとその利点" class="sidebar-link">インターフェイスとその利点</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#spring-beansでインターフェイスの利用が推奨される理由" class="sidebar-link">Spring beansでインターフェイスの利用が推奨される理由</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#application-contextとはspringが管理するコンテナのこと" class="sidebar-link">application-contextとはSpringが管理するコンテナのこと</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#複数ファイルからapplicationcontextを作成する" class="sidebar-link">複数ファイルからApplicationContextを作成する</a></li><li class="sidebar-sub-header"><a href="/core-spring-memo/contents/1_di.html#wip-積み残し課題" class="sidebar-link">[WIP] 積み残し課題</a></li></ul></li><li><a href="/core-spring-memo/contents/2_aop.html" class="sidebar-link">Aspect oriented programming</a></li><li><a href="/core-spring-memo/contents/3_data-management.html" class="sidebar-link">Data Management: JDBC, Transactions, JPA, Spring Data</a></li><li><a href="/core-spring-memo/contents/4_spring-boot.html" class="sidebar-link">Spring Boot</a></li><li><a href="/core-spring-memo/contents/5_mvc.html" class="sidebar-link">Spring MVC and the Web Layer</a></li><li><a href="/core-spring-memo/contents/6_security.html" class="sidebar-link">Security</a></li><li><a href="/core-spring-memo/contents/7_rest.html" class="sidebar-link">REST</a></li><li><a href="/core-spring-memo/contents/8_testing.html" class="sidebar-link">Testing</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="container-dependency-and-ioc"><a href="#container-dependency-and-ioc" aria-hidden="true" class="header-anchor">#</a> Container, Dependency, and IOC</h1><h2 id="dependency-injectionとその利点"><a href="#dependency-injectionとその利点" aria-hidden="true" class="header-anchor">#</a> Dependency Injectionとその利点</h2><p>Dependency Injection (DI)は「依存性の注入」と訳される。<br>
必要なインスタンス（依存性）を<strong>外から代入</strong>することで、各モジュールが疎結合になるように設計する。<br>
硬い言葉で表現すると、あるオブジェクトに対して、利用（依存）しているオブジェクトを注入することで、オブジェクト間の依存関係を作成する。</p><p><img src="/core-spring-memo/assets/img/C001_DI.83f1d512.png" alt="C001_DI"></p><p>DIを行うメリットとしては、</p><ul><li>クラス間・Layer間を疎結合化できる。</li><li>Unitテストがしやすくなる（Testabilityの向上）</li><li>インスタンスの差し替えなどが可能となる（例えば、テスト時に開発系・テスト系・本番系のデータアクセスクラスを用意してDIしたり）。</li></ul><p>などが挙げられる。</p><h3 id="spring-frameworkにおけるdiの方法"><a href="#spring-frameworkにおけるdiの方法" aria-hidden="true" class="header-anchor">#</a> Spring FrameworkにおけるDIの方法</h3><ol><li>Javaコンフィグファイル</li><li>アノテーション</li><li>XML (→古いのでほとんど使われない)</li></ol><div class="danger custom-block"><p class="custom-block-title">注意</p><p>XMLによる設定はすでにレガシーなので、原則的には使わないようにしましょう。</p></div><h3 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h3><p><a href="https://www.slideshare.net/masatoshitada7/30spring-5-spring-boot-2-103523666" target="_blank" rel="noopener noreferrer">初めてでも30分で分かるSpring 5 &amp; Spring Boot 2オーバービュー<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="パターン・アンチパターンとは。diとはパターンなのか？"><a href="#パターン・アンチパターンとは。diとはパターンなのか？" aria-hidden="true" class="header-anchor">#</a> パターン・アンチパターンとは。DIとはパターンなのか？</h2><p>アンチパターンとは、推奨されない設計のことを指す。<br>
DIも設計パターンの一部と言える。</p><p>従来型のクラス設計（Servlet、ビジネスロジック、DAO、DTO）は、お互いが密結合になりがち。
結果として、改修を重ねるごとに改修の難易度が増す（ビジネスロジックの複雑化・肥大化が原因の1つ）。</p><p>DIを利用したクラス設計を行うことで、上記の各クラスが疎結合化し、関心事の分離が可能となる。
結果として、コードがスッキリする。</p><h2 id="インターフェイスとその利点"><a href="#インターフェイスとその利点" aria-hidden="true" class="header-anchor">#</a> インターフェイスとその利点</h2><p>DIを行う上で、インターフェイスの用意は必須と言える。</p><p>（DIの利点ではないが）インターフェイスを用意することで、ポリモーフィズムの活用などでメリットが生まれる。</p><h3 id="_1-jdk-proxy"><a href="#_1-jdk-proxy" aria-hidden="true" class="header-anchor">#</a> 1. JDK Proxy</h3><p>インターフェイスを実装したクラスにインジェクション（Spring FrameworkだとこちらがDefault。インターフェイス持たないクラスの場合、CGlib Proxyに処理を委譲する仕組みになっている）<br>
当たり前だが、インターフェイスを持たないクラスをProxy化することはできない。</p><h3 id="_2-cglib-proxy"><a href="#_2-cglib-proxy" aria-hidden="true" class="header-anchor">#</a> 2. CGlib Proxy</h3><p>スーパークラスを継承したクラスにインジェクション（Spring BootだとこちらがDefault）<br>
スーパークラス側で<code>final</code>のついたクラス・メソッドは継承・オーバーライドができないため、それらのクラスはProxy化することができない。</p><h2 id="spring-beansでインターフェイスの利用が推奨される理由"><a href="#spring-beansでインターフェイスの利用が推奨される理由" aria-hidden="true" class="header-anchor">#</a> Spring beansでインターフェイスの利用が推奨される理由</h2><p>Spring FrameworkではJDK Proxyがデフォルトとなっており、JDK ProxyによるProxy生成の前提条件として、インターフェースの実装があるため。</p><h2 id="application-contextとはspringが管理するコンテナのこと"><a href="#application-contextとはspringが管理するコンテナのこと" aria-hidden="true" class="header-anchor">#</a> application-contextとはSpringが管理するコンテナのこと</h2><p>SpringのConfigurationクラスやApplicationクラスをインスタンス化する（これらインスタンスのことをBeanと呼ぶ）と、SpringのコンテナであるApplicationContext下で管理される。</p><p><img src="/core-spring-memo/assets/img/C009_1_DI.e036f09e.png" alt="C009_1_DI.png"></p><p>Applicationクラスの例。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferService</span> <span class="token punctuation">{</span>
    <span class="token comment">// Needed to perform moneytransfers between accounts</span>
    <span class="token keyword">public</span> <span class="token function">TransferServiceImpl</span><span class="token punctuation">(</span>AccountRepository ar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>accountRepository <span class="token operator">=</span> ar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcAccountRepository</span> <span class="token keyword">implements</span> <span class="token class-name">AccountRepository</span> <span class="token punctuation">{</span>
    <span class="token comment">// Needed to load accounts from the database</span>
    <span class="token keyword">public</span> <span class="token function">JdbcAccountRepository</span><span class="token punctuation">(</span>DataSource ds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Configurationクラス（Configuration Instructions）の例。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> TransferService <span class="token function">transferService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TransferServiceImpl</span><span class="token punctuation">(</span><span class="token function">accountRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> AccountRepository <span class="token function">accountRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcAccountRepository</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        BasicDataSource dataSource <span class="token operator">=</span> New <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.postgresql.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:postgresql://localhost/transfer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>実行クラスの例。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Create the application from the configuration</span>
ApplicationContext context <span class="token operator">=</span> 
    SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span> ApplicationConfig<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Look up the application service interface</span>
<span class="token comment">// &quot;transferService&quot;がBean IDとなる。</span>
TransferService service <span class="token operator">=</span> 
    context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>“transferService”<span class="token punctuation">,</span> TransferService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use the application</span>
service<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MonetaryAmount</span><span class="token punctuation">(</span>“<span class="token number">300.00</span>”<span class="token punctuation">)</span><span class="token punctuation">,</span> “<span class="token number">1</span>”<span class="token punctuation">,</span> “<span class="token number">2</span>”<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>BeanへのアクセスはBean IDがユニークである場合に限り、以下のようにBean IDを省略できる（基本的に、Bean IDはユニークであるように設計するため、以下の書き方が一般的）。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// No need for bean id if type is unique</span>
TransferService ts3 <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>TransferService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="junitのテストクラス作成（diしない場合の例）"><a href="#junitのテストクラス作成（diしない場合の例）" aria-hidden="true" class="header-anchor">#</a> JUnitのテストクラス作成（DIしない場合の例）</h3><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferServiceTests</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> TransferService service<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create the application from the configuration</span>
        ApplicationContext context <span class="token operator">=</span>
            SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span> ApplicationConfig<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Look up the application service interface</span>
        service <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>TransferService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">moneyTransfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Confirmation receipt <span class="token operator">=</span>
            service<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MonetaryAmount</span><span class="token punctuation">(</span><span class="token string">&quot;300.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;500.00&quot;</span><span class="token punctuation">,</span> receipt<span class="token punctuation">.</span><span class="token function">getNewBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="複数ファイルからapplicationcontextを作成する"><a href="#複数ファイルからapplicationcontextを作成する" aria-hidden="true" class="header-anchor">#</a> 複数ファイルからApplicationContextを作成する</h2><p><code>@Configuration</code>アノテーションを付けたクラスは長くなりがちなので、分割しておくことができる。</p><p>特定のConfigクラスを読み込むには、<code>@Import</code>アノテーションをつけて、読み込むクラス名を指定する。</p><p>大元のConfigクラス。<code>ApplicationConfig</code>クラスと<code>WebConfig</code>クラスをインポートしている。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ApplicationConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> WebConfig<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InfrastructureConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>インポートされるConfigクラスたち。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Application</code> Beansと<code>Infrastructure</code> Beansを分離しておくのがBest Practices。</p><p><img src="/core-spring-memo/assets/img/C010_1_DI.1a08c3c9.png" alt="C010_1_DI.png"></p><p>以下に２つに分割する前の例を示す。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> TransferService <span class="token function">transferService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TransferServiceImpl</span><span class="token punctuation">(</span><span class="token function">accountRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> AccountRepository <span class="token function">accountRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcAccountRepository</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        BasicDataSource dataSource <span class="token operator">=</span> New <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.postgresql.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:postgresql://localhost/transfer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下に分割後の例を示す。<br><code>ApplicationConfig</code>クラス内のBeanは、インポート先の<code>TestInfrastructureConfig</code>クラスのDataSourceのBeanに依存している。</p><p>DataSourceのBeanを使うために、<code>@Autowired</code>アノテーションを使って、別のconfigクラスのBeanを取得する（これをインジェクションという）。コンストラクタでインジェクションするのが普通。</p><div class="language-java extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> DataSource dataSource<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token function">ApplicationConfig</span><span class="token punctuation">(</span>DataSource ds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span> 
    <span class="token keyword">public</span> TransferService <span class="token function">transferService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TransferServiceImpl</span> <span class="token punctuation">(</span> <span class="token function">accountRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span> 
    <span class="token keyword">public</span> AccountRepository <span class="token function">accountRepository</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcAccountRepository</span><span class="token punctuation">(</span> dataSource <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>ApplicationConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestInfrastructureConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span> 
    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>What is the concept of a “container” and what is its lifecycle?</li><li>How are you going to create a new instance of an ApplicationContext?</li><li>Can you describe the lifecycle of a Spring Bean in an ApplicationContext?</li><li>How are you going to create an ApplicationContext in an integration test test?</li><li>What is the preferred way to close an application context? Does Spring Boot do this for you?</li></ul><h2 id="wip-積み残し課題"><a href="#wip-積み残し課題" aria-hidden="true" class="header-anchor">#</a> [WIP] 積み残し課題</h2><ul><li>Dependency injection using annotations (@Component, @Autowired)?</li><li>Component scanning, Stereotypes and Meta-Annotations?</li><li>Scopes for Spring beans? What is the default scope?</li><li>Are beans lazily or eagerly instantiated by default? How do you alter this behavior?</li><li>What is a property source? How would you use @PropertySource?</li><li>What is a BeanFactoryPostProcessor and what is it used for? When is it invoked?</li><li>Why would you define a static @Bean method?</li><li>What is a ProperySourcesPlaceholderConfigurer used for?</li><li>What is a BeanPostProcessor and how is it different to a BeanFactoryPostProcessor?</li><li>What do they do? When are they called?</li><li>What is an initialization method and how is it declared on a Spring bean?</li><li>What is a destroy method, how is it declared and when is it called?</li><li>Consider how you enable JSR-250 annotations like @PostConstruct and @PreDestroy? When/how will they get called?</li><li>How else can you define an initialization or destruction method for a Spring bean?</li><li>What does component-scanning do?</li><li>What is the behavior of the annotation @Autowired with regards to field injection, constructor injection and method injection?</li><li>What do you have to do, if you would like to inject something into a private field? Ho does this impact testing?</li><li>How does the @Qualifier annotation complement the use of @Autowired?</li><li>What is a proxy object and what are the two different types of proxies Spring can create?</li><li>What are the limitations of these proxies (per type)?</li><li>What is the power of a proxy object and where are the disadvantages?</li><li>What are the advantages of Java Config? What are the limitations?</li><li>What does the @Bean annotation do?</li><li>What is the default bean id if you only use @Bean? How can you override this?</li><li>Why are you not allowed to annotate a final class with @Configuration</li><li>How do @Configuration annotated classes support singleton beans?</li><li>Why can’t @Bean methods be final either?</li><li>How do you configure profiles?, What are possible use cases where they might be useful?</li><li>Can you use @Bean together with @Profile?</li><li>Can you use @Component together with @Profile?</li><li>How many profiles can you have?</li><li>How do you inject scalar/literal values into Spring beans?</li><li>What is @Value used for?</li><li>What is Spring Expression Language (SpEL for short)?</li><li>What is the Environment abstraction in Spring?</li><li>Where can properties in the environment come from – there are many sources for properties – check the documentation if not sure. Spring Boot adds even more.</li><li>What can you reference using SpEL?</li><li>What is the difference between $ and # in @Value expressions?</li></ul></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/Imamachi-n/core-spring-memo/edit/master/docs/contents/1_di.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="last-updated"><span class="prefix">Last Updated: </span><span class="time">7/22/2018, 12:07:52 PM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/core-spring-memo/contents/" class="prev router-link-active">
          はじめに
        </a></span><span class="next"><a href="/core-spring-memo/contents/2_aop.html">
          Aspect oriented programming
        </a> →
      </span></p></div></div></div></div>
    <script src="/core-spring-memo/assets/js/5.6e32d06f.js" defer></script><script src="/core-spring-memo/assets/js/app.8e8db30d.js" defer></script>
  </body>
</html>
